<head>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

  <style>

@media screen and (max-width: 767px) {
    /* Adjust grid for mobile - 2 items per row */
    .col-lg-4.col-md-6.col-sm-6 {
        width: 50%;
        padding: 0 8px;
        float: left;
    }

    /* Style product container */
    .product__item {
        margin-bottom: 20px;
    }

    /* Image container styling */
    .product__item__pic {
        position: relative;
        padding-top: 100%; /* Square aspect ratio */
    }

    .product__item__pic img.default-img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    /* Always show wishlist on mobile */
    .product__hover {
        opacity: 1;
        position: absolute;
        right: 10px;
        top: 10px;
        transform: none;
        width: auto;
    }

    .product__hover li {
        width: auto;
        background: rgba(255, 255, 255, 0.8);
        border-radius: 50%;
        margin-bottom: 10px;
    }

    /* Product text content adjustments */
    .product__item__text {
        padding: 10px 5px;
        text-align: left;
    }

    /* Brand name styling */
    .product__item__text h6.text-muted {
        font-size: 12px;
        margin: 5px 0;
        text-align: left;
    }

    /* Product name styling */
    .product__item__text h6:not(.text-muted) {
        font-size: 13px;
        margin: 5px 0;
        height: 36px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-align: left;
    }

    /* Add to cart button styling */
    .product__item__text .add-cart {
        display: inline-block;
        padding: 6px 12px;
        background: #000;
        color: #fff;
        border-radius: 4px;
        margin: 8px 0;
        font-size: 12px;
        width: 90%;
        text-align: center;
    }

    /* Price and offer styling */
    .product__item__text .h5 {
        font-size: 15px;
        margin: 5px 0;
        display: block;
    }

    .product__item__text .small {
        font-size: 11px;
        display: inline-block;
    }

    .product__item__text .text-muted s {
        font-size: 12px;
        margin: 0;
    }

    /* Out of stock badge */
    .bg-danger.text-white.rounded {
        display: inline-block;
        margin: 5px 0;
        font-size: 10px !important;
        padding: 3px 6px !important;
    }

    /* Rating stars sizing */
    .rating {
        margin-top: 5px;
    }

    .rating i {
        font-size: 14px;
        margin: 0 1px;
    }

    /* No products message styling */
    h4.text-danger {
        width: 100%;
        text-align: center;
        margin-top: 20px;
    }

    h4.text-danger + p {
        width: 100%;
        text-align: center;
        margin-bottom: 20px;
    }
}

/* Preserve desktop hover effects */
@media screen and (min-width: 768px) {
    .product__hover {
        opacity: 0;
        transition: all 0.5s;
    }

    .product__item:hover .product__hover {
        opacity: 1;
    }
}
/* Filter Button */
.mobile-filter-btn {
    display: none !important; 
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #000;
    color: white;
    border: none;
    border-radius: 50px;
    padding: 12px 25px;
    font-size: 14px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 999;
    display: flex;
    align-items: center;
    gap: 8px;
}

/* Filter Modal */
.mobile-filter-modal {
    display: none;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: white;
    z-index: 1000;
    border-radius: 20px 20px 0 0;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.1);
    transform: translateY(100%);
    transition: transform 0.3s ease-out;
}

.mobile-filter-modal.show {
    transform: translateY(0);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    border-bottom: 1px solid #eee;
}

.modal-header h5 {
    margin: 0;
    font-size: 16px;
    font-weight: 600;
}

.modal-close {
    background: none;
    border: none;
    font-size: 20px;
    color: #666;
    padding: 5px;
}

.modal-body {
    height: 80vh;
    overflow-y: auto;
    padding: 15px;
}

/* Overlay */
.mobile-filter-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    z-index: 999;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.mobile-filter-overlay.show {
    opacity: 1;
}

/* Mobile Specific Styles */
@media (max-width: 768px) {
    .shop__sidebar {
        display: none; /* Hide original sidebar */
    }
    
    .mobile-filter-btn {
        display: flex !important;
    }
    
    .mobile-filter-modal {
        display: block;
    }
    
    /* Style accordion inside modal */
    .mobile-filter-modal .accordion .card {
        border: none;
        margin-bottom: 8px;
    }
    
    .mobile-filter-modal .card-heading {
        display: block;
        padding: 12px 15px;
        background: #f8f9fa;
        border-radius: 8px;
        margin-bottom: 2px;
    }
    
    .mobile-filter-modal .accordion-header {
        color: #333;
        font-weight: 500;
        text-decoration: none;
        display: block;
    }
    
    .mobile-filter-modal .sidebar-link {
        padding: 12px 15px;
        display: block;
        color: #666;
        text-decoration: none;
        border-bottom: 1px solid #eee;
    }
    
    .mobile-filter-modal .sidebar-link.active {
        color: #007bff;
        background: #f0f7ff;
    }
    
    /* Clear filters button */
    .clear-filters {
        display: block;
        width: calc(100% - 30px);
        margin: 15px;
        padding: 12px;
        background: #f8f9fa;
        border: 1px solid #ddd;
        border-radius: 8px;
        text-align: center;
        color: #666;
        text-decoration: none;
    }
}
#product-list {
  position: absolute;
  background-color: #ffffff; /* Transparent background */
  border: 1px solid #ddd;
  border-radius: 4px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  max-height: 300px;
  overflow-y: auto;
  width: 30%; /* Reduced width to 50% */
  z-index: 1000;
  margin-top: 5px;
  text-align: center;
  left: 50%; /* Center the container */
  transform: translateX(-50%); /* Offset to truly center it */
}

.product-item {
  padding: 10px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
  transition: background-color 0.2s;
}

.product-item:hover {
  background-color: #f9f9f9;
}

.product-item h5 {
  margin: 0;
  font-size: 16px;
  color: #333;
}

.product-item p {
  margin: 5px 0 0;
  font-size: 14px;
  color: #666;
}

#product-list:empty {
  display: none;
}

</style>
</head>

<%- include('../../views/partials/user/header') %>

<!-- Breadcrumb Section Begin -->
<section class="breadcrumb-option">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <div class="shop_title">
          <h3>Shop Your Artistic Essentials</h3>
          <h5>
            From brushes to paints,<br />find the perfect tools for every
            project
          </h5>
        </div>
        <div class="breadcrumb__text">
          <div class="breadcrumb__links">
            <a href="/">Home</a>
            <span>Shop</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Breadcrumb Section End -->

<div class="mt-5">
  <!-- Search Bar -->
  <form method="GET" action="/search">
    <div class="input-group mb-3">
      <input type="text" class="form-control" name="search" placeholder="Search ..." aria-label="Search" aria-describedby="basic-addon2" value="<%= search || '' %>" />
      <button class="btn btn-primary p-2" type="submit">
        Search
      </button>
    </div>
    <div id="product-list" class="mt-3"></div>

    <!-- Hidden inputs for current filters -->
    <input type="hidden" name="category" value="<%= selectedCategory %>">
    <input type="hidden" name="gt" value="<%= gt %>">
    <input type="hidden" name="lt" value="<%= lt %>">
    <input type="hidden" name="rating" value="<%= rating %>">
    <input type="hidden" name="sortBy" value="<%= sortBy %>">

  </form>
</div>

<section class="shop spad">
  <div class="container">
    <div class="row">
      <div class="col-lg-3">
        <div class="shop__sidebar">
          <div class="shop__sidebar__accordion">
      
            <!-- Accordion Sections -->
            <div class="accordion" id="accordionExample">
              <!-- Sort By Section -->
              <div class="card">
                <div class="card-heading">
                  <a data-toggle="collapse" data-target="#collapseSortBy" class="accordion-header">Sort By</a>
                </div>
                <div id="collapseSortBy" class="collapse" data-parent="#accordionExample">
                  <div class="card-body">
                    <div class="shop__sidebar__sort">
                      <ul class="sidebar-list">
                        <li>
                          <a href="/sortBy?sortBy=featured&page=1" class="sidebar-link <%= sortBy === 'featured' ? 'active' : '' %>">Featured</a>
                        </li>
                        <li>
                          <a href="/sortBy?sortBy=newArrivals&page=1" class="sidebar-link <%= sortBy === 'newArrivals' ? 'active' : '' %>">New Arrivals</a>
                        </li>
                        <li>
                          <a href="/sortBy?sortBy=aToZ&page=1" class="sidebar-link <%= sortBy === 'aToZ' ? 'active' : '' %>">A - Z</a>
                        </li>
                        <li>
                          <a href="/sortBy?sortBy=zToA&page=1" class="sidebar-link <%= sortBy === 'zToA' ? 'active' : '' %>">Z - A</a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
      
              <!-- Categories Section -->
              <div class="card">
                <div class="card-heading">
                  <a data-toggle="collapse" data-target="#collapseOne" class="accordion-header">Categories</a>
                </div>
                <div id="collapseOne" class="collapse" data-parent="#accordionExample">
                  <div class="card-body">
                    <div class="shop__sidebar__categories">
                      <ul class="sidebar-list">
                        <% for (let i = 0; i < Math.min(categories.length, 3); i++) { %>
                        <li>
                          <a href="/filter?category=<%= categories[i]._id %>" class="sidebar-link <%= selectedCategory && selectedCategory.toString() === categories[i]._id.toString() ? 'active' : '' %>">
                            <%= categories[i].name %>
                          </a>
                        </li>
                        <% } %>
                      </ul>
      
                      <% if (categories.length > 3) { %>
                      <a href="javascript:void(0);" id="showMoreBtn" class="show-more">Show More</a>
                      <% } %>
      
                      <div id="extraCategories" style="display:none;">
                        <ul class="sidebar-list">
                          <% for (let i = 3; i < categories.length; i++) { %>
                          <li>
                            <a href="/filter?category=<%= categories[i]._id %>" class="sidebar-link <%= selectedCategory && selectedCategory.toString() === categories[i]._id.toString() ? 'active' : '' %>">
                              <%= categories[i].name %>
                            </a>
                          </li>
                          <% } %>
                        </ul>
                        <a href="javascript:void(0);" id="showLessBtn" class="show-less" style="display:none;">Show Less</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
      
              <!-- Filter Price Section -->
              <div class="card">
                <div class="card-heading">
                  <a data-toggle="collapse" data-target="#collapseThree" class="accordion-header">Filter Price</a>
                </div>
                <div id="collapseThree" class="collapse" data-parent="#accordionExample">
                  <div class="card-body">
                    <div class="shop__sidebar__price">
                      <ul class="sidebar-list">
                        <li>
                          <a href="/filterPrice?gt=0&lt=500&sortBy=<%= sortBy %>" class="sidebar-link <%= (gt === 0 && lt === 500) ? 'active' : '' %>">Under ₹500.00</a>
                        </li>
                        <li>
                          <a href="/filterPrice?gt=500&lt=1000&sortBy=<%= sortBy %>" class="sidebar-link <%= (gt === 500 && lt === 1000) ? 'active' : '' %>">₹500.00 - ₹1000.00</a>
                        </li>
                        <li>
                          <a href="/filterPrice?gt=1000&lt=1500&sortBy=<%= sortBy %>" class="sidebar-link <%= (gt === 1000 && lt === 1500) ? 'active' : '' %>">₹1000.00 - ₹1500.00</a>
                        </li>
                        <li>
                          <a href="/filterPrice?gt=1500&lt=100000&sortBy=<%= sortBy %>" class="sidebar-link <%= (gt === 1500 && lt === 100000) ? 'active' : '' %>">₹1500.00+</a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
      
              <!-- Rating Filter Accordion -->
              <div class="card">
                <div class="card-heading">
                  <a data-toggle="collapse" data-target="#collapseRating" class="accordion-header">Filter by Rating</a>
                </div>
                <div id="collapseRating" class="collapse" data-parent="#accordionExample">
                  <div class="card-body">
                    <div class="shop__sidebar__rating">
                      <ul class="sidebar-list">
                        <li>
                          <a href="/shop?rating=1&page=1&sortBy=<%= sortBy %>" class="sidebar-link <%= rating === 1 ? 'active' : '' %>">1 Star & above</a>
                        </li>
                        <li>
                          <a href="/shop?rating=2&page=1&sortBy=<%= sortBy %>" class="sidebar-link <%= rating === 2 ? 'active' : '' %>">2 Stars & above</a>
                        </li>
                        <li>
                          <a href="/shop?rating=3&page=1&sortBy=<%= sortBy %>" class="sidebar-link <%= rating === 3 ? 'active' : '' %>">3 Stars & above</a>
                        </li>
                        <li>
                          <a href="/shop?rating=4&page=1&sortBy=<%= sortBy %>" class="sidebar-link <%= rating === 4 ? 'active' : '' %>">4 Stars & above</a>
                        </li>
                        <li>
                          <a href="/shop?rating=5&page=1&sortBy=<%= sortBy %>" class="sidebar-link <%= rating === 5 ? 'active' : '' %>">5 Stars</a>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-9" style="margin-top: -70px;">
        <div class="shop__product__option">
          <div class="row">
            <div class="col-lg-6 col-md-6 col-sm-6">
              <!-- <div class="shop__product__option__left">
                                <p>Showing 1–12 of 100 results</p>
                            </div> -->
            </div>
            <!-- Sorting Dropdown -->
            <div class="col-lg-6 col-md-6 col-sm-6">
              <div class="shop__product__option__right">
                <p class="mr-2">Sort by Price:</p>
                <select id="sortDropdown" onchange="location = this.value;">
                  <option>Choose</option>
                  <option value="?sortBy=lowToHigh&page=<%= currentPage %>&category=<%= selectedCategory %>&gt=<%= gt %>&lt=<%= lt %>&rating=<%= rating %>" <%= sortBy === 'lowToHigh' ? 'selected' : '' %>>Low To High</option>
                  <option value="?sortBy=highToLow&page=<%= currentPage %>&category=<%= selectedCategory %>&gt=<%= gt %>&lt=<%= lt %>&rating=<%= rating %>" <%= sortBy === 'highToLow' ? 'selected' : '' %>>High To Low</option>
                </select>
              </div>
            </div>


          </div>
        </div>
        <div class="row">
          <!-- Display message if no products are found -->
          <% if (noProductsMessage) { %>
          <h4 class="text-danger">Oops!</h4>
          <p><%= noProductsMessage %></p>
          <% } %>
          <% if (noProductsinCategory) { %>
          <h4 class="text-danger">Oops!</h4>
          <p><%= noProductsinCategory %></p>
          <% } %>
          <% for (let i = 0; i < products.length; i++) { %>
          <div class="col-lg-4 col-md-6 col-sm-6">
            <div class="product__item">
              <div class="product__item__pic set-bg">
                <a href="/product-details?id=<%= products[i]._id %>">
                  <img class="default-img" src="<%= products[i].productImage[0] %>" alt="<%= products[i].productName %>" />
                </a>
                <ul class="product__hover">
                  <li>
                    <a href="javascript:void(0);" data-product-id="<%= products[i]._id %>" class="add-wishlist">
                      <img src="img/icon/heart.png" alt="Add to Wishlist" />
                    </a>
                  </li>
                  <!-- <li><a href="#"><img src="img/icon/compare.png" alt=""> <span>Compare</span></a>
                                    </li>
                                    <li><a href="#"><img src="img/icon/search.png" alt=""></a></li> -->
                </ul>
              </div>
              <div class="product__item__text">
                <% if (products[i].brand && products[i].brand.brandName) { %>
                <h6 class="text-muted text-start mt-2"><%= products[i].brand.brandName %></h6>
                <% } else { %>
                <h6 class="text-muted text-start mt-2">No Brand</h6>
                <% } %>
                <h6><%= products[i].productName %></h6>
                <% if (products[i].quantity > 0) { %>
                <a href="#" data-product-id="<%= products[i]._id %>" class="add-cart"> Add to cart </a>
                <% } %>
                <span class="h5">&#8377; <%= products[i].salePrice.toLocaleString('en-IN')
                  %></span>
                <% if (products[i].productOffer > 0) { %>
                <span class="small">(<%= products[i].productOffer %>% off)</span>
                <% if (products[i].quantity <= 0) { %>
                <span class="bg-danger text-white rounded p-1 mb-2" style="font-size: 10px;">Out of Stock</span><br />
                <% } %>
                <p class="text-muted">
                  <s>&#8377; <%= products[i].regularPrice.toLocaleString('en-IN') %></s>
                </p>
                <% } %>

                <!-- Display Stars Below Price -->
                <div class="rating">
                  <% 
                      let averageRating = products[i].averageRating || 0; 
                      let fullStars = Math.floor(averageRating); 
                      let halfStar = averageRating % 1 >= 0.5 ? 1 : 0; 
                      let emptyStars = 5 - fullStars - halfStar; 
                    %>

                  <!-- Full Stars -->
                  <% for (let i = 0; i < fullStars; i++) { %>
                  <i class="bi bi-star-fill" style="color: #4f4b4b;"></i> <!-- Full Star -->
                  <% } %>

                  <!-- Half Star -->
                  <% if (halfStar) { %>
                  <i class="bi bi-star-half" style="color: #4f4b4b;"></i> <!-- Half Star -->
                  <% } %>

                </div>

              </div>
            </div>
          </div>
          <% } %>
        </div>
      </div>
    </div>


    <!-- Pagination -->
    <div class="container mt-3">
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mb-20" style="margin-right: 200px">
          <% for (let i = 1; i <= totalPages; i++) { %>
          <li class="page-item <%= (i === currentPage) ? 'active' : '' %>">
            <a class="page-link" href="?page=<%= i %>&sortBy=<%= sortBy %>&rating=<%= rating %>"><%= i %></a>
          </li>
          <% } %>
        </ul>
      </nav>
    </div>


  </div>
</section>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<script>
  document.getElementById('showMoreBtn')?.addEventListener('click', function() {
    document.getElementById('extraCategories').style.display = 'block';

    document.getElementById('showMoreBtn').style.display = 'none';

    document.getElementById('showLessBtn').style.display = 'inline';
  });

  document.getElementById('showLessBtn')?.addEventListener('click', function() {
    document.getElementById('extraCategories').style.display = 'none';

    document.getElementById('showMoreBtn').style.display = 'inline';

    document.getElementById('showLessBtn').style.display = 'none';
  });
  document.addEventListener('DOMContentLoaded', () => {
    const addToCartButtons = document.querySelectorAll('.add-cart');

    addToCartButtons.forEach((button) => {
      button.addEventListener('click', async (event) => {
        event.preventDefault();

        const productId = event.target.getAttribute('data-product-id');

        if (!productId) {
          console.error('No product ID found!');
          return;
        }

        try {
          const response = await fetch('/addToCart', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              productId: productId,
            }),
            credentials: 'same-origin',
          });

          const data = await response.json();

          if (data.success) {
            Swal.fire({
              title: 'Success!',
              text: 'Item added to cart',
              icon: 'success',
              confirmButtonColor: '#3085d6',
              confirmButtonText: 'OK',
            }).then(() => {
              location.reload();
            });
          } else {
            Swal.fire({
              title: 'Error',
              text: data.message,
              icon: 'warning',
              showCancelButton: true,
              confirmButtonColor: '#3085d6',
              cancelButtonColor: '#d33',
              confirmButtonText: 'Login',
              cancelButtonText: 'Cancel',
            }).then((result) => {
              if (result.isConfirmed) {
                window.location.href = '/login';
              }
            });
          }
        } catch (error) {
          console.error("Error:", error);
          alert("There was an error adding the item to the cart.");
        }
      });
    });

    // Add event listener for adding to the wishlist
    const addToWishlistButtons = document.querySelectorAll('.add-wishlist');
    addToWishlistButtons.forEach(button => {
  button.addEventListener('click', async (event) => {
    event.preventDefault(); // Prevent default anchor behavior

    const productId = event.target.closest('a').getAttribute('data-product-id'); // Get the product ID

    if (!productId) {
      console.error('No product ID found!');
      return;
    }

    // Disable the button to prevent multiple clicks
    event.target.disabled = true;

    try {
      const response = await fetch('/addToWishlist', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ productId }),
        credentials: 'same-origin',
      });

      const data = await response.json();

      if (data.success) {
        Swal.fire({
          title: 'Success!',
          text: 'Item added to wishlist',
          icon: 'success',
          confirmButtonColor: '#3085d6',
          confirmButtonText: 'Go to Wishlist',
          cancelButtonText: 'Cancel'
        }).then((result) => {
          if (result.isConfirmed) {
            window.location.href = "/userProfile?section=wishlist";
          }
        });
      } else {
        let confirmButtonText = 'OK';
        let redirectUrl = null;

        if (data.message === 'Please log in to add items to the wishlist.') {
          confirmButtonText = 'Login';
          redirectUrl = '/login';
        } else if (data.message === 'This product is already in your wishlist.') {
          confirmButtonText = 'Go to wishlist';
          redirectUrl = '/userProfile?section=wishlist';
        }

        Swal.fire({
          title: 'Error',
          text: data.message,
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#3085d6',
          cancelButtonColor: '#d33',
          confirmButtonText: confirmButtonText,
          cancelButtonText: 'Cancel',
        }).then((result) => {
          if (result.isConfirmed && redirectUrl) {
            window.location.href = redirectUrl;
          }
        });
      }
    } catch (error) {
      console.error('Error:', error);
      alert('There was an error adding the item to the wishlist.');
    } finally {
      // Re-enable the button after the request is complete
      event.target.disabled = false;
    }
  });
});

  });

  document.addEventListener('DOMContentLoaded', function() {
  const mobileIcons = document.querySelectorAll('.mobile-icon');

  mobileIcons.forEach(icon => {
    icon.addEventListener('click', function() {
      const target = this.getAttribute('data-target');
      const collapseElement = document.querySelector(target);

      // Close all other accordion sections
      document.querySelectorAll('.accordion .collapse').forEach(collapse => {
        if (collapse.id !== collapseElement.id) {
          collapse.classList.remove('show');
        }
      });

      // Toggle the clicked accordion section
      collapseElement.classList.toggle('show');
    });
  });

    // Create and append filter button
    const filterBtn = document.createElement('button');
    filterBtn.className = 'mobile-filter-btn';
    filterBtn.innerHTML = '<i class="fas fa-filter"></i> Filters';
    document.body.appendChild(filterBtn);

    const modalHTML = `
    <div class="mobile-filter-overlay"></div>
    <div class="mobile-filter-modal">
        <div class="modal-header">
            <h5>Filters</h5>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <!-- Filter Sections -->
            <div class="shop__sidebar__sort">
                <h6 class="filter-title">Sort By</h6>
                <ul class="sidebar-list">
                    <li>
                        <a href="/sortBy?sortBy=featured&page=1" class="sidebar-link <%= sortBy === 'featured' ? 'active' : '' %>">Featured</a>
                    </li>
                    <li>
                        <a href="/sortBy?sortBy=newArrivals&page=1" class="sidebar-link <%= sortBy === 'newArrivals' ? 'active' : '' %>">New Arrivals</a>
                    </li>
                    <li>
                        <a href="/sortBy?sortBy=aToZ&page=1" class="sidebar-link <%= sortBy === 'aToZ' ? 'active' : '' %>">A - Z</a>
                    </li>
                    <li>
                        <a href="/sortBy?sortBy=zToA&page=1" class="sidebar-link <%= sortBy === 'zToA' ? 'active' : '' %>">Z - A</a>
                    </li>
                </ul>
            </div>

            <div class="shop__sidebar__categories">
                <h6 class="filter-title">Categories</h6>
                <ul class="sidebar-list">
                    <% for (let i = 0; i < Math.min(categories.length, 3); i++) { %>
                    <li>
                        <a href="/filter?category=<%= categories[i]._id %>" class="sidebar-link <%= selectedCategory && selectedCategory.toString() === categories[i]._id.toString() ? 'active' : '' %>">
                            <%= categories[i].name %>
                        </a>
                    </li>
                    <% } %>
                </ul>

                <% if (categories.length > 3) { %>
                <a href="javascript:void(0);" id="showMoreBtn" class="show-more">Show More</a>
                <% } %>

                <div id="extraCategories" style="display:none;">
                    <ul class="sidebar-list">
                        <% for (let i = 3; i < categories.length; i++) { %>
                        <li>
                            <a href="/filter?category=<%= categories[i]._id %>" class="sidebar-link <%= selectedCategory && selectedCategory.toString() === categories[i]._id.toString() ? 'active' : '' %>">
                                <%= categories[i].name %>
                            </a>
                        </li>
                        <% } %>
                    </ul>
                    <a href="javascript:void(0);" id="showLessBtn" class="show-less" style="display:none;">Show Less</a>
                </div>
            </div>

            <div class="shop__sidebar__price">
                <h6 class="filter-title">Filter Price</h6>
                <ul class="sidebar-list">
                    <li>
                        <a href="/filterPrice?gt=0&lt=500&sortBy=<%= sortBy %>" class="sidebar-link <%= (gt === 0 && lt === 500) ? 'active' : '' %>">Under ₹500.00</a>
                    </li>
                    <li>
                        <a href="/filterPrice?gt=500&lt=1000&sortBy=<%= sortBy %>" class="sidebar-link <%= (gt === 500 && lt === 1000) ? 'active' : '' %>">₹500.00 - ₹1000.00</a>
                    </li>
                    <li>
                        <a href="/filterPrice?gt=1000&lt=1500&sortBy=<%= sortBy %>" class="sidebar-link <%= (gt === 1000 && lt === 1500) ? 'active' : '' %>">₹1000.00 - ₹1500.00</a>
                    </li>
                    <li>
                        <a href="/filterPrice?gt=1500&lt=100000&sortBy=<%= sortBy %>" class="sidebar-link <%= (gt === 1500 && lt === 100000) ? 'active' : '' %>">₹1500.00+</a>
                    </li>
                </ul>
            </div>

            <div class="shop__sidebar__rating">
                <h6 class="filter-title">Filter by Rating</h6>
                <ul class="sidebar-list">
                    <li>
                        <a href="/shop?rating=1&page=1&sortBy=<%= sortBy %>" class="sidebar-link <%= rating === 1 ? 'active' : '' %>">1 Star & above</a>
                    </li>
                    <li>
                        <a href="/shop?rating=2&page=1&sortBy=<%= sortBy %>" class="sidebar-link <%= rating === 2 ? 'active' : '' %>">2 Stars & above</a>
                    </li>
                    <li>
                        <a href="/shop?rating=3&page=1&sortBy=<%= sortBy %>" class="sidebar-link <%= rating === 3 ? 'active' : '' %>">3 Stars & above</a>
                    </li>
                    <li>
                        <a href="/shop?rating=4&page=1&sortBy=<%= sortBy %>" class="sidebar-link <%= rating === 4 ? 'active' : '' %>">4 Stars & above</a>
                    </li>
                    <li>
                        <a href="/shop?rating=5&page=1&sortBy=<%= sortBy %>" class="sidebar-link <%= rating === 5 ? 'active' : '' %>">5 Stars</a>
                    </li>
                </ul>
            </div>
            <!-- Clear Filters Button -->
        <a href="/shop" class="clear-filters">Clear Filters</a>
        </div>
    </div>
`;
document.body.insertAdjacentHTML('beforeend', modalHTML);

    // Get references to elements
    const modal = document.querySelector('.mobile-filter-modal');
    const overlay = document.querySelector('.mobile-filter-overlay');
    const closeBtn = document.querySelector('.modal-close');
    const sidebar = document.querySelector('.shop__sidebar');
    const modalBody = document.querySelector('.modal-body');

    // Clone sidebar content to modal
    if (sidebar && modalBody) {
        modalBody.appendChild(sidebar.cloneNode(true));
    }

    // Open modal
    filterBtn.addEventListener('click', () => {
        modal.classList.add('show');
        overlay.style.display = 'block';
        setTimeout(() => overlay.classList.add('show'), 10);
        document.body.style.overflow = 'hidden';
    });

    // Close modal function
    const closeModal = () => {
        modal.classList.remove('show');
        overlay.classList.remove('show');
        setTimeout(() => overlay.style.display = 'none', 300);
        document.body.style.overflow = '';
    };

    // Close modal events
    closeBtn.addEventListener('click', closeModal);
    overlay.addEventListener('click', closeModal);

    // Prevent modal close when clicking inside
    modal.addEventListener('click', (e) => e.stopPropagation());
    
});

  const searchInput = document.querySelector('input[name="search"]');
  const productListContainer = document.querySelector('#product-list');

  searchInput.addEventListener('input', async (e) => {
    const searchTerm = e.target.value;
    if (searchTerm.length > 0) {
      const response = await fetch(`/search?search=${searchTerm}`, {
        headers: {
          'X-Requested-With': 'XMLHttpRequest', // Indicate AJAX request
        },
      });
      const products = await response.json();
      renderProducts(products);
    } else {
      productListContainer.innerHTML = ''; // Clear results if search term is empty
    }
  });

  function renderProducts(products) {
    if (products.length > 0) {
      productListContainer.innerHTML = products
        .map(
          (product) => `
            <div class="product-item">
              <a href="/product-details?id=${product._id}"><h5>${product.productName}</h5></a>
              <p>Price: ₹${product.salePrice}</p>
            </div>
          `
        )
        .join('');
    } else {
      productListContainer.innerHTML = '<div class="product-item">No products found</div>';
    }
  }

  // Close the live search results when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('#product-list') && !e.target.closest('input[name="search"]')) {
      productListContainer.innerHTML = '';
    }
  });
</script>

<%- include('../../views/partials/user/footer') %>